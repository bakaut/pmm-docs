# MindScribe Function

MindScribe - это облачная функция для создания интеллектуальных саммари и анализа контента с помощью AI.

## Основные возможности

- **Многоуровневая суммаризация**: Создание саммари различных временных периодов
- **AI-анализ контента**: Использование GPT-4 для анализа и структурирования информации
- **Telegram Bot интеграция**: Взаимодействие через Telegram
- **Персистентное хранение**: Сохранение саммари в PostgreSQL

## Типы саммари

- **LALL**: Полное саммари всех сообщений в сессии
- **L1**: Саммари за последние 15 сообщений
- **L2**: Агрегированное саммари из 4 блоков L1
- **L3**: Агрегированное саммари из 4 блоков L2
- **L4**: Агрегированное саммари из 4 блоков L3

## Файлы проекта

- `index.py` - Основной код функции
- `requirements.txt` - Python зависимости
- `system_prompt.txt` - Системный промпт для AI
- `init.sql` - Начальная миграция базы данных
- `migrate-1.sql` - Миграция для существующей базы данных

## Terraform конфигурация

Функция конфигурируется через `mindscribe.tf`, который создает:
- Yandex Cloud Function
- Архив с кодом
- Логирование через Yandex Logging
- Переменные окружения

## База данных

Функция использует таблицу `summary` со следующей структурой:
- `id` - UUID, первичный ключ
- `session_id` - Идентификатор сессии
- `user_id` - Идентификатор пользователя
- `role` - Роль автора (user/assistant/system)
- `content` - Содержимое саммари
- `created_at` - Время создания
- `type` - Тип саммари (LALL/L1/L2/L3/L4)

## Деплой

1. Убедитесь, что все секреты настроены в `secrets/common.yaml`
2. Выполните миграцию базы данных: `psql -f mindscribe/migrate-1.sql`
3. Запустите Terraform: `terraform apply`
